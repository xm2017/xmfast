<site>
  <packgetName>com.80sla</packgetName>
  <minApi>1</minApi>
  <author name="noName" avatarUrl="" description="大神在此" donateUrl="" />

  <info type="801" versionCode="012" versionName="v1.2" name="80s" description=""
    iconUrl="https://m.80s.la/wap/picture/logo.jpg"
    subscribeUrl="https://raw.githubusercontent.com/xm2017/xmfast/master/demo/siteApp80sla.html" />

  <rule type="101" typeOnclickAction="" subTypeName="电影" jsMethod="list();"
    url="https://m.80s.la/movie/1-%count%-0-0-0-0" currentPageCountHolder="%count%" searchKeywordHolder="">
    <script>
      function list() {
        var host = "";
        var datalist = $("div.col-xs-4.col-md-2.list_mov");
        if (datalist.length == 0) {
          var response = { "code": "200", "msg": "suc", "content": "" };
          return response;
        }
        var tmparray = new Array();
        $(datalist).each(function () {
          var href = $(this).find("div.list_mov_title").find("a").attr("href").trim();
          var title = $(this).find("div.list_mov_title").find("a").text().trim();
          var imgurl = "https:" + $(this).find("img").attr("src").trim();
          var content = $(this).find("div.list_mov_title").find("em").text().trim();
          var obj = { "title": title, "detailUrl": href, "posterUrl": imgurl, "content": content };
          tmparray.push(obj);
        });
        var response = { "code": "200", "msg": "suc", "content": JSON.stringify(tmparray) };
        return response;
      }
    </script>

  </rule>

  <rule type="101" typeOnclickAction="" subTypeName="追剧" jsMethod="list();" url="https://m.80s.la/ju/12-%count%-0-0-0-0"
    currentPageCountHolder="%count%" searchKeywordHolder="">
    <script>
      function list() {
        var host = "";
        var datalist = $("div.col-xs-4.col-md-2.list_mov");
        if (datalist.length == 0) {
          var response = { "code": "200", "msg": "suc", "content": "" };
          return response;
        }
        var tmparray = new Array();
        $(datalist).each(function () {
          var href = $(this).find("div.list_mov_title").find("a").attr("href").trim();
          var title = $(this).find("div.list_mov_title").find("a").text().trim();
          var imgurl = "https:" + $(this).find("img").attr("src").trim();
          var content = $(this).find("div.list_mov_title").find("em").text().trim();
          var obj = { "title": title, "detailUrl": href, "posterUrl": imgurl, "content": content };
          tmparray.push(obj);
        });
        var response = { "code": "200", "msg": "suc", "content": JSON.stringify(tmparray) };
        return response;
      }
    </script>
  </rule>

  <rule type="101" typeOnclickAction="" subTypeName="动漫" jsMethod="list();" url="https://m.80s.la/dm/14-%count%-0-0-0-0"
    currentPageCountHolder="%count%" searchKeywordHolder="">
    <script>
      function list() {
        var host = "";
        var datalist = $("div.col-xs-4.col-md-2.list_mov");
        if (datalist.length == 0) {
          var response = { "code": "200", "msg": "suc", "content": "" };
          return response;
        }
        var tmparray = new Array();
        $(datalist).each(function () {
          var href = $(this).find("div.list_mov_title").find("a").attr("href").trim();
          var title = $(this).find("div.list_mov_title").find("a").text().trim();
          var imgurl = "https:" + $(this).find("img").attr("src").trim();
          var content = $(this).find("div.list_mov_title").find("em").text().trim();
          var obj = { "title": title, "detailUrl": href, "posterUrl": imgurl, "content": content };
          tmparray.push(obj);
        });
        var response = { "code": "200", "msg": "suc", "content": JSON.stringify(tmparray) };
        return response;
      }
    </script>

  </rule>

  <rule type="101" typeOnclickAction="" subTypeName="综艺" jsMethod="list();" url="https://m.80s.la/zy/4-%count%-0-0-0-0"
    currentPageCountHolder="%count%" searchKeywordHolder="">
    <script>
      function list() {
        var host = "";
        var datalist = $("div.col-xs-4.col-md-2.list_mov");
        if (datalist.length == 0) {
          var response = { "code": "200", "msg": "suc", "content": "" };
          return response;
        }
        var tmparray = new Array();
        $(datalist).each(function () {
          var href = $(this).find("div.list_mov_title").find("a").attr("href").trim();
          var title = $(this).find("div.list_mov_title").find("a").text().trim();
          var imgurl = "https:" + $(this).find("img").attr("src").trim();
          var content = $(this).find("div.list_mov_title").find("em").text().trim();
          var obj = { "title": title, "detailUrl": href, "posterUrl": imgurl, "content": content };
          tmparray.push(obj);
        });
        var response = { "code": "200", "msg": "suc", "content": JSON.stringify(tmparray) };
        return response;
      }
    </script>

  </rule>

  <rule type="102" jsMethod="detail();">
    <script>
      function detail() {
        var host = "";
        var response;
        var posterUrl;
        var pageTitle;
        var content;
        var allText;
        var shortText;
        var actor = "<br>";
        var allDownList = new Array();

        posterUrl = "https:" + $("img.img-responsive.col-xs-6").attr("src").trim();
        pageTitle = $("h1.movie-h1").text().replace(/\s/g, "").trim();
        actor = $("p.col-xs-6").html().trim();

        allText = $("p.col-lg-12").text().trim();
        shortText = allText.substring(0, allText.length > 200 ? 200 : allText.length).trim();

        var tmpDownloadSort = {};
        $("ul.nav.nav-tabs").find("li.active").each(function (position) {
          tmpDownloadSort[position] = $(this).find("a").text();
        });
        $("div.tab-content").each(function (position) {
          var oneDownList = new Array();
          $(this).find("a").each(function () {
            var href = $(this).attr("href").trim();
            var title = $(this).text().trim();
            var downloadBean = {
              "name": title,
              "href": host + href
            };
            oneDownList.push(downloadBean);
          });
          var pageDetail = {
            "title": tmpDownloadSort[position],
            "downlistInfos": oneDownList
          };
          if (tmpDownloadSort[position].includes("MP4") || tmpDownloadSort[position].includes("西瓜")) { } else {
            allDownList.push(pageDetail);
          }
        });
        var pageInfo = {
          "posterUrl": posterUrl,
          "title": pageTitle,
          "allText": allText,
          "shortText": shortText,
          "summary": actor,
          "downlist": allDownList,
          "content": content
        };
        var response = {
          "code": "200",
          "msg": "suc",
          "content": pageInfo
        };
        console.log("result:" + JSON.stringify(response));
        return response;
      }
    </script>
  </rule>

  <rule type="103" typeOnclickAction="" subTypeName="" jsMethod="search();" url="http://m.80s.la/search"
    searchPostData="keyword=%keyword%" currentPageCountHolder="%count%" searchKeywordHolder="%keyword%">
    <script>
      function search() {
        var host = "";
        var datalist = $("div.list-group").find("a.list-group-item");
        if (datalist.length == 0) {
          var response = {
            "code": "200",
            "msg": "suc",
            "content": ""
          };
          return response;
        }
        var tmparray = new Array();
        $(datalist).each(function () {
          var href = $(this).attr("href");
          var tmp1 = $(this).find("h4.list-group-item-heading").find("span").text().trim();
          var tmp2 = $(this).find("h4.list-group-item-heading").find("small").text().trim();
          var title = $(this).find("h4.list-group-item-heading").text().replace(tmp1, "").replace(tmp2, "").replace("\t", "").trim();
          var imgurl = "";
          var content = $(this).find("p.list-group-item-text").text().trim();
          var obj = {
            "title": title,
            "detailUrl": href,
            "posterUrl": imgurl,
            "content": content
          };
          tmparray.push(obj);
        });
        var response = {
          "code": "200",
          "msg": "suc",
          "content": JSON.stringify(tmparray)
        };
        return response;
      }
    </script>
  </rule>
</site>